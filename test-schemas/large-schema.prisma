generator client {
  provider = "prisma-client-js"
}

generator typegraphql {
  provider            = "typegraphql-prisma"
  output              = "../generated"
  formatGeneratedCode = "biome"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums - many to test enum generation performance
enum UserRole {
  ADMIN
  MANAGER
  EMPLOYEE
  CUSTOMER
  GUEST
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
  RETURNED
}

enum PaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  FAILED
  CANCELLED
  REFUNDED
  PARTIAL_REFUND
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  STRIPE
  APPLE_PAY
  GOOGLE_PAY
  BANK_TRANSFER
  CASH
  CRYPTOCURRENCY
}

enum ProductStatus {
  DRAFT
  ACTIVE
  INACTIVE
  DISCONTINUED
  OUT_OF_STOCK
  BACK_ORDER
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  PAST_DUE
  CANCELLED
  UNPAID
  INCOMPLETE
  INCOMPLETE_EXPIRED
}

enum NotificationType {
  EMAIL
  SMS
  PUSH
  IN_APP
  WEBHOOK
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  BOUNCED
  CLICKED
  OPENED
}

enum InventoryStatus {
  IN_STOCK
  LOW_STOCK
  OUT_OF_STOCK
  DISCONTINUED
  BACK_ORDER
  PRE_ORDER
}

enum ShippingMethod {
  STANDARD
  EXPRESS
  OVERNIGHT
  TWO_DAY
  SAME_DAY
  PICKUP
  DIGITAL
}

enum CouponType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
  BUY_ONE_GET_ONE
  BULK_DISCOUNT
}

enum EventType {
  USER_REGISTERED
  ORDER_PLACED
  PAYMENT_PROCESSED
  PRODUCT_VIEWED
  CART_ABANDONED
  SUBSCRIPTION_CREATED
  SUPPORT_TICKET_CREATED
}

enum SupportTicketStatus {
  OPEN
  IN_PROGRESS
  WAITING_FOR_CUSTOMER
  ESCALATED
  RESOLVED
  CLOSED
}

enum SupportTicketPriority {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
  ARCHIVED
  DELETED
}

enum LogLevel {
  DEBUG
  INFO
  WARN
  ERROR
  FATAL
}

enum CompanySize {
  STARTUP
  SMALL
  MEDIUM
  LARGE
  ENTERPRISE
}

enum Industry {
  TECHNOLOGY
  HEALTHCARE
  FINANCE
  RETAIL
  MANUFACTURING
  EDUCATION
  GOVERNMENT
  NONPROFIT
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CampaignType {
  EMAIL
  SMS
  PUSH_NOTIFICATION
  SOCIAL_MEDIA
  DISPLAY_ADS
  SEARCH_ADS
}

enum ReportType {
  SALES
  INVENTORY
  CUSTOMER
  MARKETING
  FINANCIAL
  OPERATIONAL
}

enum IntegrationType {
  CRM
  ERP
  PAYMENT_GATEWAY
  SHIPPING_PROVIDER
  EMAIL_SERVICE
  ANALYTICS
  INVENTORY_MANAGEMENT
}

enum APIKeyStatus {
  ACTIVE
  REVOKED
  EXPIRED
  SUSPENDED
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  DONE
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// Models - many to test model generation performance
model User {
  id              String    @id @default(cuid())
  email           String    @unique
  username        String?   @unique
  firstName       String
  lastName        String
  role            UserRole  @default(CUSTOMER)
  isActive        Boolean   @default(true)
  isEmailVerified Boolean   @default(false)
  lastLoginAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  profile         UserProfile?
  addresses       Address[]
  orders          Order[]
  reviews         Review[]
  wishlistItems   WishlistItem[]
  cartItems       CartItem[]
  subscriptions   Subscription[]
  supportTickets  SupportTicket[]
  notifications   Notification[]
  auditLogs       AuditLog[]
  socialLogins    SocialLogin[]
  userPreferences UserPreference[]
  employee        Employee?
  loyaltyAccount  LoyaltyAccount?
}

model UserProfile {
  id          String    @id @default(cuid())
  userId      String    @unique
  avatar      String?
  bio         String?
  phoneNumber String?
  dateOfBirth DateTime?
  gender      String?
  timezone    String?
  locale      String?
  website     String?
  company     String?
  jobTitle    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Address {
  id           String   @id @default(cuid())
  userId       String
  type         String // billing, shipping, etc.
  firstName    String
  lastName     String
  company      String?
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  postalCode   String
  country      String
  isDefault    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders Order[]
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  image       String?
  parentId    String?
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")
  products Product[]
}

model Product {
  id               String        @id @default(cuid())
  name             String
  slug             String        @unique
  description      String?
  shortDescription String?
  sku              String        @unique
  status           ProductStatus @default(DRAFT)
  price            Decimal
  comparePrice     Decimal?
  costPrice        Decimal?
  weight           Decimal?
  dimensions       Json?
  images           String[]
  tags             String[]
  metaTitle        String?
  metaDescription  String?
  categoryId       String
  brandId          String?
  vendorId         String?
  isDigital        Boolean       @default(false)
  isFeatured       Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  category        Category                @relation(fields: [categoryId], references: [id])
  brand           Brand?                  @relation(fields: [brandId], references: [id])
  vendor          Vendor?                 @relation(fields: [vendorId], references: [id])
  variants        ProductVariant[]
  reviews         Review[]
  orderItems      OrderItem[]
  cartItems       CartItem[]
  wishlistItems   WishlistItem[]
  inventories     Inventory[]
  bundleItems     BundleItem[]
  attributeValues ProductAttributeValue[]
}

model ProductVariant {
  id           String   @id @default(cuid())
  productId    String
  name         String
  sku          String   @unique
  price        Decimal?
  comparePrice Decimal?
  weight       Decimal?
  dimensions   Json?
  image        String?
  options      Json // color, size, etc.
  isDefault    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  product     Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
  orderItems  OrderItem[]
  cartItems   CartItem[]
  inventories Inventory[]
}

model Brand {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  logo        String?
  website     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  products Product[]
}

model Vendor {
  id        String   @id @default(cuid())
  name      String   @unique
  email     String   @unique
  phone     String?
  website   String?
  address   Json?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products Product[]
}

model Inventory {
  id                String          @id @default(cuid())
  productId         String
  variantId         String?
  warehouseId       String
  quantity          Int
  reservedQuantity  Int             @default(0)
  status            InventoryStatus @default(IN_STOCK)
  lowStockThreshold Int             @default(10)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  product   Product         @relation(fields: [productId], references: [id])
  variant   ProductVariant? @relation(fields: [variantId], references: [id])
  warehouse Warehouse       @relation(fields: [warehouseId], references: [id])

  @@unique([productId, variantId, warehouseId])
}

model Warehouse {
  id        String   @id @default(cuid())
  name      String   @unique
  address   Json
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inventories Inventory[]
  shipments   Shipment[]
}

model Order {
  id                String      @id @default(cuid())
  orderNumber       String      @unique
  userId            String
  status            OrderStatus @default(PENDING)
  subtotal          Decimal
  taxAmount         Decimal     @default(0)
  shippingAmount    Decimal     @default(0)
  discountAmount    Decimal     @default(0)
  total             Decimal
  currency          String      @default("USD")
  shippingAddressId String?
  billingAddressId  String?
  notes             String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  user            User        @relation(fields: [userId], references: [id])
  shippingAddress Address?    @relation(fields: [shippingAddressId], references: [id])
  items           OrderItem[]
  payments        Payment[]
  shipments       Shipment[]
  refunds         Refund[]
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  productId String
  variantId String?
  quantity  Int
  price     Decimal
  total     Decimal
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order   Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])
}

model Payment {
  id            String        @id @default(cuid())
  orderId       String
  amount        Decimal
  currency      String        @default("USD")
  method        PaymentMethod
  status        PaymentStatus @default(PENDING)
  transactionId String?
  gatewayData   Json?
  failureReason String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  order   Order    @relation(fields: [orderId], references: [id])
  refunds Refund[]
}

model Refund {
  id          String    @id @default(cuid())
  orderId     String
  paymentId   String
  amount      Decimal
  reason      String
  status      String    @default("pending")
  processedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  order   Order   @relation(fields: [orderId], references: [id])
  payment Payment @relation(fields: [paymentId], references: [id])
}

model Shipment {
  id             String         @id @default(cuid())
  orderId        String
  warehouseId    String
  trackingNumber String?
  method         ShippingMethod @default(STANDARD)
  status         String         @default("pending")
  shippedAt      DateTime?
  deliveredAt    DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  order     Order     @relation(fields: [orderId], references: [id])
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  variantId String?
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([userId, productId, variantId])
}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@unique([userId, productId])
}

model Review {
  id          String   @id @default(cuid())
  userId      String
  productId   String
  rating      Int // 1-5
  title       String?
  comment     String?
  isVerified  Boolean  @default(false)
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@unique([userId, productId])
}

model Coupon {
  id            String     @id @default(cuid())
  code          String     @unique
  type          CouponType
  value         Decimal
  minimumAmount Decimal?
  maximumAmount Decimal?
  usageLimit    Int?
  usedCount     Int        @default(0)
  isActive      Boolean    @default(true)
  startsAt      DateTime?
  expiresAt     DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model Subscription {
  id        String             @id @default(cuid())
  userId    String
  planId    String
  status    SubscriptionStatus @default(TRIAL)
  startDate DateTime
  endDate   DateTime?
  trialEnds DateTime?
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  user User             @relation(fields: [userId], references: [id])
  plan SubscriptionPlan @relation(fields: [planId], references: [id])
}

model SubscriptionPlan {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  price       Decimal
  interval    String // monthly, yearly
  trialDays   Int?
  features    Json?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  subscriptions Subscription[]
}

model Notification {
  id        String             @id @default(cuid())
  userId    String
  type      NotificationType
  status    NotificationStatus @default(PENDING)
  title     String
  message   String
  data      Json?
  readAt    DateTime?
  sentAt    DateTime?
  createdAt DateTime           @default(now())

  user User @relation(fields: [userId], references: [id])
}

model SupportTicket {
  id          String                @id @default(cuid())
  userId      String
  subject     String
  description String
  status      SupportTicketStatus   @default(OPEN)
  priority    SupportTicketPriority @default(NORMAL)
  assigneeId  String?
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt

  user     User             @relation(fields: [userId], references: [id])
  messages SupportMessage[]
}

model SupportMessage {
  id         String   @id @default(cuid())
  ticketId   String
  userId     String?
  message    String
  isInternal Boolean  @default(false)
  createdAt  DateTime @default(now())

  ticket SupportTicket @relation(fields: [ticketId], references: [id])
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  resource   String
  resourceId String?
  oldValues  Json?
  newValues  Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  user User? @relation(fields: [userId], references: [id])
}

model SocialLogin {
  id         String   @id @default(cuid())
  userId     String
  provider   String // google, facebook, twitter, etc.
  providerId String
  email      String?
  name       String?
  avatar     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerId])
}

model UserPreference {
  id        String   @id @default(cuid())
  userId    String
  key       String
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, key])
}

model Content {
  id          String        @id @default(cuid())
  title       String
  slug        String        @unique
  content     String
  excerpt     String?
  type        String // blog, page, etc.
  status      ContentStatus @default(DRAFT)
  publishedAt DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model SystemLog {
  id        String   @id @default(cuid())
  level     LogLevel
  message   String
  context   Json?
  createdAt DateTime @default(now())
}

model SystemSetting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Company {
  id           String      @id @default(cuid())
  name         String      @unique
  slug         String      @unique
  description  String?
  website      String?
  logo         String?
  size         CompanySize @default(SMALL)
  industry     Industry
  foundedYear  Int?
  headquarters Json? // address object
  taxId        String?
  billingEmail String?
  supportEmail String?
  isActive     Boolean     @default(true)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  employees    Employee[]
  departments  Department[]
  projects     Project[]
  integrations Integration[]
  campaigns    Campaign[]
  reports      Report[]
  apiKeys      APIKey[]
}

model Employee {
  id           String    @id @default(cuid())
  userId       String    @unique
  companyId    String
  employeeId   String    @unique
  departmentId String?
  position     String
  hireDate     DateTime
  salary       Decimal?
  manager      String? // references another employee
  permissions  Json? // role-based permissions
  isActive     Boolean   @default(true)
  terminatedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  user          User        @relation(fields: [userId], references: [id])
  company       Company     @relation(fields: [companyId], references: [id])
  department    Department? @relation(fields: [departmentId], references: [id])
  assignedTasks Task[]      @relation("AssignedTasks")
  createdTasks  Task[]      @relation("CreatedTasks")
  timeEntries   TimeEntry[]
}

model Department {
  id          String   @id @default(cuid())
  companyId   String
  name        String
  description String?
  headId      String? // employee who heads this department
  budget      Decimal?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company   Company    @relation(fields: [companyId], references: [id])
  employees Employee[]
  projects  Project[]

  @@unique([companyId, name])
}

model Project {
  id           String       @id @default(cuid())
  companyId    String
  departmentId String?
  name         String
  description  String?
  status       TaskStatus   @default(TODO)
  priority     TaskPriority @default(MEDIUM)
  budget       Decimal?
  startDate    DateTime?
  endDate      DateTime?
  completedAt  DateTime?
  progress     Int          @default(0) // 0-100
  tags         String[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  company     Company     @relation(fields: [companyId], references: [id])
  department  Department? @relation(fields: [departmentId], references: [id])
  tasks       Task[]
  timeEntries TimeEntry[]
  documents   Document[]
}

model Task {
  id             String       @id @default(cuid())
  projectId      String
  assigneeId     String?
  creatorId      String
  title          String
  description    String?
  status         TaskStatus   @default(TODO)
  priority       TaskPriority @default(MEDIUM)
  dueDate        DateTime?
  estimatedHours Decimal?
  actualHours    Decimal?
  completedAt    DateTime?
  tags           String[]
  dependencies   String[] // task IDs this task depends on
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  project     Project       @relation(fields: [projectId], references: [id])
  assignee    Employee?     @relation("AssignedTasks", fields: [assigneeId], references: [id])
  creator     Employee      @relation("CreatedTasks", fields: [creatorId], references: [id])
  timeEntries TimeEntry[]
  comments    TaskComment[]
}

model TaskComment {
  id        String   @id @default(cuid())
  taskId    String
  userId    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  task Task @relation(fields: [taskId], references: [id])
}

model TimeEntry {
  id          String    @id @default(cuid())
  employeeId  String
  projectId   String?
  taskId      String?
  description String?
  startTime   DateTime
  endTime     DateTime?
  duration    Int? // in minutes
  billable    Boolean   @default(true)
  hourlyRate  Decimal?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id])
  project  Project? @relation(fields: [projectId], references: [id])
  task     Task?    @relation(fields: [taskId], references: [id])
}

model Document {
  id          String   @id @default(cuid())
  projectId   String?
  name        String
  description String?
  fileUrl     String
  fileSize    Int
  mimeType    String
  version     String   @default("1.0")
  tags        String[]
  uploadedBy  String
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  project Project? @relation(fields: [projectId], references: [id])
}

model Campaign {
  id            String         @id @default(cuid())
  companyId     String
  name          String
  description   String?
  type          CampaignType
  status        CampaignStatus @default(DRAFT)
  targetSegment Json? // customer segmentation criteria
  content       Json // campaign content/templates
  budget        Decimal?
  spent         Decimal        @default(0)
  scheduledAt   DateTime?
  startedAt     DateTime?
  endedAt       DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  company   Company             @relation(fields: [companyId], references: [id])
  analytics CampaignAnalytics[]
}

model CampaignAnalytics {
  id          String   @id @default(cuid())
  campaignId  String
  date        DateTime @db.Date
  impressions Int      @default(0)
  clicks      Int      @default(0)
  conversions Int      @default(0)
  revenue     Decimal  @default(0)
  cost        Decimal  @default(0)
  createdAt   DateTime @default(now())

  campaign Campaign @relation(fields: [campaignId], references: [id])

  @@unique([campaignId, date])
}

model Report {
  id          String     @id @default(cuid())
  companyId   String
  name        String
  description String?
  type        ReportType
  parameters  Json // report configuration
  data        Json // report results
  generatedBy String
  isPublic    Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  company Company @relation(fields: [companyId], references: [id])
}

model Integration {
  id            String          @id @default(cuid())
  companyId     String
  name          String
  type          IntegrationType
  provider      String
  configuration Json // API keys, endpoints, etc.
  isActive      Boolean         @default(true)
  lastSyncAt    DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  company Company @relation(fields: [companyId], references: [id])

  @@unique([companyId, type, provider])
}

model APIKey {
  id          String       @id @default(cuid())
  companyId   String
  name        String
  keyHash     String       @unique // hashed API key
  permissions Json // scoped permissions
  status      APIKeyStatus @default(ACTIVE)
  lastUsedAt  DateTime?
  expiresAt   DateTime?
  createdBy   String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  company Company @relation(fields: [companyId], references: [id])
}

model ProductBundle {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Decimal
  discount    Decimal  @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  items BundleItem[]
}

model BundleItem {
  id        String  @id @default(cuid())
  bundleId  String
  productId String
  quantity  Int     @default(1)
  discount  Decimal @default(0)

  bundle  ProductBundle @relation(fields: [bundleId], references: [id])
  product Product       @relation(fields: [productId], references: [id])

  @@unique([bundleId, productId])
}

model ProductAttribute {
  id         String   @id @default(cuid())
  name       String   @unique
  type       String // text, number, boolean, select, multiselect
  options    String[] // for select/multiselect types
  isRequired Boolean  @default(false)
  sortOrder  Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  values ProductAttributeValue[]
}

model ProductAttributeValue {
  id          String @id @default(cuid())
  productId   String
  attributeId String
  value       String

  product   Product          @relation(fields: [productId], references: [id])
  attribute ProductAttribute @relation(fields: [attributeId], references: [id])

  @@unique([productId, attributeId])
}

model CustomerSegment {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  criteria    Json // segmentation rules
  userCount   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  members CustomerSegmentMember[]
}

model CustomerSegmentMember {
  id        String @id @default(cuid())
  segmentId String
  userId    String

  segment CustomerSegment @relation(fields: [segmentId], references: [id])

  @@unique([segmentId, userId])
}

model LoyaltyProgram {
  id              String   @id @default(cuid())
  name            String   @unique
  description     String?
  pointsPerDollar Decimal  @default(1)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  accounts LoyaltyAccount[]
  rewards  LoyaltyReward[]
}

model LoyaltyAccount {
  id             String   @id @default(cuid())
  userId         String   @unique
  programId      String
  points         Int      @default(0)
  lifetimePoints Int      @default(0)
  tier           String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user         User                 @relation(fields: [userId], references: [id])
  program      LoyaltyProgram       @relation(fields: [programId], references: [id])
  transactions LoyaltyTransaction[]
}

model LoyaltyTransaction {
  id          String   @id @default(cuid())
  accountId   String
  points      Int // positive for earned, negative for redeemed
  description String
  orderId     String?
  createdAt   DateTime @default(now())

  account LoyaltyAccount @relation(fields: [accountId], references: [id])
}

model LoyaltyReward {
  id          String   @id @default(cuid())
  programId   String
  name        String
  description String?
  pointsCost  Int
  value       Decimal?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  program LoyaltyProgram @relation(fields: [programId], references: [id])
}
